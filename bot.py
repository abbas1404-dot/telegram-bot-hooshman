import os
from flask import Flask, request
import requests

TOKEN = "8228546920:AAED-uM-Srx8MA0y0-Mc-6dx1sczQQjysNA"
TELEGRAM_API = f"https://api.telegram.org/bot{TOKEN}"

keyboard = {
    "inline_keyboard": [
        [{"text": "๐ ุฏูุฑูโูุง ูุนุงู", "callback_data": "courses"}],
        [{"text": "๐ ูุฎูุงูู ุซุจุช ูุงู ฺฉูู", "url": "https://t.me/hooshman_support"}]
        [{"text": "๐ ุฏุฑุงูุช ฺฏูุงููุงูู", "callback_data": "cert"}],
        [{"text": "๐ชช  ุฏุฑุงูุช ฺฉุงุฑุช ุขุฒููู", "callback_data": "card"}],
        [{"text": "๐ ุชุนุฑูู ุขุฒููู", "callback_data": "fee"}],
        [{"text": "๐ ุฏูฺฉ ูู ฺูุฏ ุงุณุชุ", "callback_data": "decile"}],
        [{"text": "๐ ููููู ุณูุงูุงุช", "callback_data": "samples"}]
        [{"text": "๐  ูพุดุชุจุงู ู ูุดุงูุฑู", "url": "https://t.me/hooshman_support"}],
        [{"text": "๐ ูุจุณุงุช ุขููุฒุดฺฏุงู", "url": "https://hooshmaniran.ir/"}],
    ]
}

WELCOME_TEXT = (
    "ุณูุงู ู ุฏุฑูุฏ ๐ธ\n"
    "ุจู **ุขฺฉุงุฏู ุชุฎุตุต ููุดูุงู** ุฎูุด ุขูุฏุฏ โ\n"
    "ุฌุง ฺฉู *ุงุฏฺฏุฑ* ุจุง *ููุดููุฏ* ููุฑุงู ูโุดูุฏ! ๐งโจ\n\n"
    "ุจุฑุง ุฏุฑุงูุช ุงุทูุงุนุงุชุ ูุทูุงู ฺฉ ุงุฒ ฺฏุฒููโูุง ุฒุฑ ุฑุง ุงูุชุฎุงุจ ฺฉูุฏ:"
)

app = Flask(__name__)

@app.route("/")
def home():
    return "OK", 200

@app.route(f"/{TOKEN}", methods=["POST"])
def webhook():
    try:
        data = request.get_json()
        if not data:
            return "No data", 400

        if "message" in data and data["message"].get("text") == "/start":
            chat_id = data["message"]["chat"]["id"]
            requests.post(
                f"{TELEGRAM_API}/sendMessage",
                json={
                    "chat_id": chat_id,
                    "text": WELCOME_TEXT,
                    "reply_markup": keyboard,
                    "parse_mode": "Markdown"
                }
            )
            return "OK", 200

        if "callback_query" in data:
            query = data["callback_query"]
            chat_id = query["message"]["chat"]["id"]
            callback_data = query["data"]

            requests.post(f"{TELEGRAM_API}/answerCallbackQuery", json={"callback_query_id": query["id"]})

            responses = {
                "courses": (
                    "๐ ุฏูุฑูโูุง ูุนุงู ุขููุฒุดฺฏุงู:\n\n"
                    "โข ููุงุฑุชโูุง ฺฉุงููพูุชุฑ\n"
                    "โข ฺฏุฑุงูฺฉ ุฏุฒุงู\n"
                    "โข ุจุฑูุงููโููุณ\n"
                    "โข ููุด ูุตููุน\n"
                    "โข ุชููุฏ ูุญุชูุง\n"
                    "โข ุทุฑุงุญ ุณุงุช\n"
                    "โข ุดุจฺฉู ู ุงููุช\n"
                    "โข ูุนูุงุฑ ู ูููุฏุณ\n"
                    "โข ููุฑูุง ุชุฌุณู\n\n"
                    "๐ ุจุฑุง ูุดุงูุฏู ุฌุฒุฆุงุช ูุฑ ุฏูุฑูุ ุจู [ูุจุณุงุช ูุง](https://hooshmaniran.ir/) ูุฑุงุฌุนู ฺฉูุฏ."
                ),
                "price": "๐ฐ ุดูุฑู ุฏูุฑูโูุง:\nโข ุขุฒููู ูู: ฒ,ตฐฐ,ฐฐฐ ุชููุงู\nโข ุฏูุฑูโูุง ุชุฎุตุต: ณ,ฒฐฐ,ฐฐฐ ุชููุงู\nโข ุจุณุชูโูุง ูฺู ุฏุงูุดุฌู ููุฌูุฏ ุงุณุช.\n\n๐ ุงูฺฉุงู ูพุฑุฏุงุฎุช ุงูุณุงุท ูุฑุงูู ุงุณุช.",
                "cert": "๐ ฺฏูุงููุงูู ูู ู ุญุฑููโุง:\nูพุณ ุงุฒ ุงุชูุงู ุฏูุฑู ู ูุจูู ุฏุฑ ุขุฒูููุ ฺฏูุงููุงูู ูุนุชุจุฑ *ูุฒุงุฑุช ฺฉุงุฑ* ุตุงุฏุฑ ูโุดูุฏ ู ูุงุจู ุงุณุชุนูุงู ุฏุฑ ุณุงูุงูู ุฑุณู ุงุณุช.",
                "card": "๐ชช ฺฉุงุฑุช ูุฑูุฏ ุจู ุขุฒููู:\nฺฉุงุฑุช ูุฑูุฏ ฒด ุณุงุนุช ูุจู ุงุฒ ุขุฒููู ุจู ุตูุฑุช ุฎูุฏฺฉุงุฑ ุจู ูพุงูโุฑุณุงู ุดูุง ุงุฑุณุงู ูโุดูุฏ. ูุทูุงู ุงุฒ ูุนุงู ุจูุฏู ุงูุชุฑูุช ู ุฏุณุชุฑุณ ุจู ูพุงูโูุง ุงุทููุงู ุญุงุตู ฺฉูุฏ.",
                "exam": "โน๏ธ ุชูุถุญุงุช ุขุฒููู:\nุขุฒููู ุดุงูู ฑฐฐ ุณุคุงู ฺูุฏฺฏุฒููโุงุ ุฏุฑ นฐ ุฏููู ุงุณุช. ูุจุงุญุซ: ูู ุนูููุ ุชุฎุตุตุ ู ููุงูู ุญุฑููโุง.",
                "fee": "๐ ุชุนุฑูู ุขุฒูููโูุง:\nโข ุขุฒููู ุงุตู: ุฑุงฺฏุงู (ุจุฑุง ุฏุงูุดุฌูุงู ุซุจุชโูุงูโุดุฏู)\nโข ุขุฒููู ุขุฒูุงุด: ฒตฐ,ฐฐฐ ุชููุงู\nโข ุขุฒููู ุจุงุฒฺฏุดุช: ุฑุงฺฏุงู",
                "decile": "๐ ุฏูฺฉ ุดูุง ฺฺฏููู ูุญุงุณุจู ูโุดูุฏุ\nุฏูฺฉ ุจุฑ ุงุณุงุณ ุฑุชุจูู ุดูุง ุฏุฑ ูุงู ฺฉู ุดุฑฺฉุชโฺฉููุฏฺฏุงู ุขุฒููู ุชุนู ูโุดูุฏ. ูพุณ ุงุฒ ุงุนูุงู ูุชุงุฌุ ุฏุฑ ฺฏูุงููุงูู ู ูพูู ฺฉุงุฑุจุฑ ุดูุง ูุงุจู ูุดุงูุฏู ุงุณุช.",
                "samples": "๐ ููููู ุณูุงูุงุช ุขุฒููู ูู ู ุญุฑููโุง:\nุฏุฑ [ุงู ููฺฉ](https://hooshmaniran.ir/samples) ูโุชูุงูุฏ ููููู ุณูุงูุงุช ุฑุงฺฏุงู ุฑุง ุฏุงูููุฏ ฺฉูุฏ.\nููฺููุ ุจุณุชูโูุง ูฺูู ุชูุฑู ุจุง ูพุงุณุฎูุงููู ุชุดุฑุญ ุฏุฑ ูุฑูุดฺฏุงู ูุง ููุฌูุฏ ุงุณุช."
            }

            text = responses.get(callback_data, "โ๏ธ ูุญุชูุง ุงู ุจุฎุด ุจู ุฒูุฏ ุจุฑูุฒุฑุณุงู ูโุดูุฏ.")

            requests.post(
                f"{TELEGRAM_API}/sendMessage",
                json={
                    "chat_id": chat_id,
                    "text": text,
                    "parse_mode": "Markdown",
                    "disable_web_page_preview": False
                }
            )
            return "OK", 200

        return "Ignored", 200

    except Exception as e:
        print("โ Error:", str(e))
        return "Error", 500

if __name__ == "__main__":
    port = int(os.environ.get("PORT", 8000))
    app.run(host="0.0.0.0", port=port)







